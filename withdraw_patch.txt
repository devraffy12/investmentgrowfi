        print(f"ğŸ’° Current user balance: â‚±{profile.balance}")

        # ğŸ”¥ INCLUDE REFERRAL EARNINGS IN WITHDRAWABLE BALANCE
        referral_earnings = Decimal('0.00')
        try:
            # Get referral earnings from Firebase
            from myproject.firebase_config import get_firebase_app, FIREBASE_AVAILABLE
            if FIREBASE_AVAILABLE:
                from firebase_admin import db as firebase_db
                ref = firebase_db.reference('/', get_firebase_app())
                users_ref = ref.child('users')
                all_users = users_ref.get() or {}
                
                # Find current user in Firebase and get referral earnings
                for user_key, user_data in all_users.items():
                    if user_data and user_data.get('phone_number') == user_phone:
                        transactions = user_data.get('transactions', {})
                        for tx_id, tx_data in transactions.items():
                            if isinstance(tx_data, dict) and tx_data.get('type') == 'referral_bonus':
                                referral_earnings += Decimal(str(tx_data.get('amount', 0)))
                        
                        # Also check referral_earnings field directly
                        firebase_referral_earnings = user_data.get('referral_earnings', 0)
                        if firebase_referral_earnings > 0:
                            referral_earnings = max(referral_earnings, Decimal(str(firebase_referral_earnings)))
                        
                        print(f"ğŸ’° Referral earnings from Firebase: â‚±{referral_earnings}")
                        break
                        
        except Exception as ref_error:
            print(f"âš ï¸ Error getting referral earnings: {ref_error}")
        
        # Calculate total withdrawable amount (balance + referral earnings)
        withdrawable_amount = profile.balance + referral_earnings
        print(f"ğŸ’° Total withdrawable amount: â‚±{withdrawable_amount} (Balance: â‚±{profile.balance} + Referral: â‚±{referral_earnings})")
